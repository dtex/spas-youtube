<!DOCTYPE html>
<html>

  <head>
    <meta charset='utf-8' />
    <meta http-equiv="X-UA-Compatible" content="chrome=1" />
    <meta name="description" content="Spas-youtube : YouTube API description for SPAS" />

    <link rel="stylesheet" type="text/css" media="screen" href="css/stylesheet.css">

    <title>spas-youtube</title>
  </head>

  <body>

    <!-- HEADER -->
    <div id="header_wrap" class="outer">
        <header class="inner">
          <a id="forkme_banner" href="https://github.com/dtex/spas-youtube">View on GitHub</a>

          <h1 id="project_title">spas-youtube</h1>
          <h2 id="project_tagline">YouTube API helpers for spas</h2>

            <section id="downloads">
              <a class="zip_download_link" href="https://github.com/dtex/spas-youtube/zipball/master">Download this project as a .zip file</a>
              <a class="tar_download_link" href="https://github.com/dtex/spas-youtube/tarball/master">Download this project as a tar.gz file</a>
            </section>

        </header>
    </div>

    <!-- MAIN CONTENT -->
    <div id="main_content_wrap" class="outer">
      <section id="main_content" class="inner">

		<p>spas-youtube offers helpers for the YouTube v2 api. The majority of requests from YouTube can be made using the generic <a href="http://dtex.github.io/spas-http">spas-http</a> request method. If there is a helper you need for YouTube v2 but don't see it here, pull requests are welcome.</p>
		<h4>videosWithKeywords</h4>
		<p>Prior to <a href="#">this</a> change in the YouTube API it was possible to retrieve a list of a videos with the tags included in the JSON. I'm not sure why, but they turned that off. You can now only get tags (keywords) if you are authenticated as the owner of the video. Further, the data is only returned when you requests details on an individual video, not when you retrieve a list of videos. videosWithKeywords will retrieve a list of videos and then make an additional request for each video, retrieve the keywords and insert them into the list. You must be authenticated with oauth2 for this to work.</p>
		<pre><code>var youtube = require("spas-youtube");

exports.mySpecialVideos = {
  youtube: {
    "resource": youtube.custom.videosWithKeywords,
    "params": {
      "url": "http://gdata.youtube.com/feeds/api/videos",
      "v": "2",
      "author": "donovan713",
      "max-results": "50",
      "alt": "json"
    },
    "cacheduration": 3500,
    "timeout": 1000,
    "auth": {
      "type": "oauth2",
      "provider": "google",
      "scope": "https://gdata.youtube.com"
    }
  }
}</code></pre>
		<p>There are some important things to remember when using videosWithKeywords:</p>
		<ul>
			<li>Set your <strong>cacheduration</strong> high. We are making a separate request for each video and I imagine the Google overlords will cut you off if you are making too many requests to their API.</li>
			<li>Set your <strong>timeout</strong> low. It's gonna timeout when your cacheduration has been reached (in this example it's gotta make 51 separate requests) so why make your users wait? Just serve up the cached response and let spas update asynchronously. The next request to spas will get the updated response.</li>
			<li>Use a <strong>filter</strong>. I'm not using one in this example because I don't want to clutter things up, but you can reduce your bundle a size a lot if you do. <a href="http://dtex.github.io/spas/buildit.html">Read more about filter</a>.</li>
		</ul>
      </section>
    </div>

    <!-- FOOTER  -->
    <div id="footer_wrap" class="outer">
      <footer class="inner">
        <p class="copyright">Spas-youtube maintained by <a href="https://github.com/dtex">dtex</a></p>
        <p>Published with <a href="http://pages.github.com">GitHub Pages</a></p>
      </footer>
    </div>

    

  </body>
</html>


videosWithKeywords: function(params, credentials, cb) { 
		
		params.url = "http://gdata.youtube.com/feeds/api/videos?v=2";
		
		spashttp.request(params, credentials, function( err, videos ) {
			
			if (_.has(videos, 'feed')) {
				
				var n = videos.feed.entry.length;
				
				// If this bundle is using oauth2, add in the access token
				var tokenString =  _.isObject(credentials) && _.has(credentials, 'access_token') ? 
					"&access_token=" + credentials.access_token : 
					'';
				
				_.each(videos.feed.entry, function( obj, key) {
					spashttp.request({url: "http://gdata.youtube.com/feeds/api/videos/" + obj.media$group.yt$videoid.$t + '?v=2&alt=json' + tokenString }, credentials, function( err, video ) {
						n=n-1;
						if(video && _.has(video, 'entry')) {
							videos.feed.entry[key].media$group.media$keywords.$t = video.entry.media$group.media$keywords.$t;
							videos.feed.entry[key].category = video.entry.category;
						}
						if (n === 0) {
							cb( null, videos );
						}
					});
				});
				
			} else {
				cb( err, videos );
			}
			
		});
